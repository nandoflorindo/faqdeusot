<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAQ DeusOT</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
    <style>
        :root { --primary: #00d9ff; --primary-glow: rgba(0, 217, 255, 0.4); --success: #00ff88; --text: #ffffff; }
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Arial, sans-serif; background: url('fundosite.png') no-repeat center center fixed; background-size: cover; min-height: 100vh; display: flex; justify-content: center; align-items: center; color: var(--text); overflow-x: hidden; }
        
        .main-container { width: 95%; max-width: 800px; background: rgba(0, 0, 0, 0.85); padding: 25px; border-radius: 20px; backdrop-filter: blur(15px); border: 1px solid rgba(0, 217, 255, 0.1); max-height: 90vh; overflow-y: auto; position: relative; }
        .logo-fixo { position: fixed; top: 25px; left: 25px; width: 140px; filter: drop-shadow(0 0 10px var(--primary-glow)); }
        
        .quick-links { position: fixed; top: 25px; right: 25px; display: flex; flex-direction: column; gap: 10px; z-index: 100; }
        .link-card { background: rgba(0,0,0,0.8); border: 1px solid var(--primary-glow); padding: 10px 15px; border-radius: 8px; text-decoration: none; color: #fff; font-size: 11px; font-weight: bold; text-align: right; cursor: pointer; transition: 0.3s; }

        /* LOGIN */
        .login-box { width: 100%; max-width: 350px; margin: 0 auto; display: flex; flex-direction: column; gap: 12px; }
        .login-field { width: 100%; padding: 15px; background: rgba(255, 255, 255, 0.1); border: 1px solid #444; border-radius: 10px; color: #fff; text-align: center; font-size: 16px; box-sizing: border-box; outline: none; }
        .btn-main { width: 100%; padding: 15px; background: transparent; border: 2px solid var(--primary); color: var(--primary); font-weight: bold; border-radius: 10px; cursor: pointer; text-transform: uppercase; }

        /* MULTI STATUS */
        .multi-status-bar { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; padding: 15px; background: rgba(0, 217, 255, 0.05); border-radius: 12px; border: 2px solid var(--primary); }
        .char-card { flex: 1; min-width: 140px; display: flex; justify-content: space-between; align-items: center; background: #000; padding: 8px 12px; border-radius: 8px; border: 1px solid #333; }
        .btn-status-mini { border: none; padding: 5px 10px; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 9px; transition: all 0.2s ease; }
        .status-on { background: #00ff88; color: #000; box-shadow: 0 0 10px #00ff88; }
        .status-off { background: #ff4444; color: #fff; }
        .copy-active { background-color: var(--success) !important; color: #000 !important; box-shadow: 0 0 15px var(--success) !important; border: none !important; }

        /* AVISOS */
        .news-banner { background: rgba(0, 217, 255, 0.05); border: 2px solid var(--primary); border-radius: 10px; padding: 15px; margin-bottom: 20px; box-shadow: 0 0 10px var(--primary-glow); }
        
        /* MODAIS */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; justify-content: center; align-items: center; z-index: 3000; visibility: hidden; opacity: 0; transition: 0.3s; }
        .modal.active { visibility: visible; opacity: 1; }
        .modal-content { background: #0a0f14; border: 2px solid var(--primary); padding: 25px; border-radius: 15px; width: 95%; max-width: 750px; position: relative; box-shadow: 0 0 25px var(--primary-glow); }
        
        .server-column { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; border: 1px solid rgba(0, 217, 255, 0.2); }
        .server-column h4 { color: var(--primary); text-align: center; border-bottom: 1px solid var(--primary); padding-bottom: 5px; margin-top:0; text-transform: uppercase; font-size: 13px; }
        .tutor-row { display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 12px; color: #ccc; padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: #444; }
        .dot.active { background: #00ff88; box-shadow: 0 0 8px #00ff88; }

        /* BUSCA */
        .search-wrapper { position: relative; width: 100%; margin: 15px 0; }
        input.search-input { width: 100%; padding: 15px; padding-right: 45px; background: rgba(0, 0, 0, 0.6); border: 2px solid #444; border-radius: 10px; color: #fff; outline: none; box-sizing: border-box; }
        .btn-clear { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; font-size: 20px; cursor: pointer; display: none; font-weight: bold; }
        .faq-item { background: rgba(255, 255, 255, 0.03); padding: 15px; border-radius: 10px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255, 255, 255, 0.1); }

        .spinner { width: 50px; height: 50px; border: 5px solid rgba(0, 217, 255, 0.1); border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <img src="logo.png" alt="Logo" class="logo-fixo">

    <div class="quick-links">
        <a href="https://deusot.com/" target="_blank" class="link-card">SITE OFICIAL üåê</a>
        <div class="link-card" onclick="toggleModal('tutorModal', true)">LISTA DE TUTORES üë•</div>
        <div id="adminQuickBtn" class="link-card hidden" style="border-color:#ffcc00; color:#ffcc00;" onclick="toggleModal('adminModal', true)">ADMIN üìä</div>
        <div class="link-card" onclick="location.reload()">SAIR üö™</div>
    </div>

    <div class="modal" id="tutorModal" onclick="if(event.target == this) toggleModal('tutorModal', false)">
        <div class="modal-content">
            <span style="position:absolute; top:10px; right:15px; cursor:pointer; color:var(--primary); font-weight:bold;" onclick="toggleModal('tutorModal', false)">‚úñ</span>
            <h3 style="color: var(--primary); text-align: center; margin-top:0;">EQUIPE ONLINE</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top:20px;">
                <div class="server-column"><h4>Titan</h4><div id="list-Titan"></div></div>
                <div class="server-column"><h4>Merc√∫rio</h4><div id="list-Mercurio"></div></div>
                <div class="server-column"><h4>Netuno</h4><div id="list-Netuno"></div></div>
            </div>
        </div>
    </div>

    <div class="modal" id="adminModal" onclick="if(event.target == this) toggleModal('adminModal', false)">
        <div class="modal-content">
            <h3 style="color: #ffcc00; text-align: center; margin-top:0;">RELAT√ìRIO DE STAFF</h3>
            <div id="adminReport" style="max-height: 350px; overflow-y: auto;"></div>
            <button onclick="confirmarLimpeza()" style="background:#ff4444; color:#fff; border:none; padding:10px; border-radius:5px; cursor:pointer; width:100%; margin-top:10px;">LIMPAR LOGS</button>
        </div>
    </div>

    <div class="main-container">
        <div id="login-screen" class="login-box">
            <h2 style="color: var(--primary); text-align: center; margin-bottom: 5px;">üõ°Ô∏è LOGIN</h2>
            <input type="text" id="userInput" class="login-field" placeholder="Nick do Personagem">
            <input type="password" id="passInput" class="login-field" placeholder="Senha da Staff" onkeypress="if(event.key === 'Enter') entrar()">
            <button class="btn-main" onclick="entrar()">ENTRAR NO PAINEL</button>
        </div>

        <div id="loading-screen" class="hidden">
            <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; padding:50px;">
                <div class="spinner"></div>
                <p style="color: var(--primary); font-weight:bold;">SINCRONIZANDO COM O SERVIDOR...</p>
            </div>
        </div>

        <div id="faq-content" class="hidden">
            <div id="multiStatusArea" class="multi-status-bar"></div>
            <div class="news-banner">
                <span style="font-size: 11px; color: var(--primary); font-weight: bold; display: block; margin-bottom: 5px;">üì¢ MENSAGEM DO SISTEMA:</span>
                <strong id="avisoTitulo" style="font-size: 16px;">Carregando...</strong>
                <p id="avisoTexto" style="font-size: 13px; color: #ccc; margin: 5px 0 0 0;"></p>
            </div>
            <div class="search-wrapper">
                <input type="text" id="searchInput" class="search-input" placeholder="Pesquisar comando ou d√∫vida..." onkeyup="handleSearch()">
                <button id="btnClear" class="btn-clear" onclick="clearSearch()">‚úï</button>
            </div>
            <div id="results"></div>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBh_ifJcUqw1w2bXKB9WbeCVgcNDMVnQ4o",
        databaseURL: "https://deusot-staff-default-rtdb.firebaseio.com",
        projectId: "deusot-staff",
        appId: "1:688428489292:web:81eba3812370df3410b2e9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const API_URL = 'https://script.google.com/macros/s/AKfycbxS-HsrfO6_StV7VRLilsMuk5h_RTshuudgOkfpUwM_tavdtMW4NM9cIewY8naXQN0J/exec';

    const listaStaff = [
        { nick: "Finalshot", server: "Titan", admin: true, dono: "Nando" },
        { nick: "Be Be", server: "Merc√∫rio", admin: true, dono: "Nando" },
        { nick: "Lord escanor", server: "Titan", admin: false, dono: "Lord" },
        { nick: "Grazyela", server: "Titan", admin: false, dono: "Grazy" },
		{ nick: "Gato Titanico", server: "Titan", admin: false, dono: "Gato" },
		{ nick: "Rafz Zagz", server: "Titan", admin: false, dono: "Rafz" },
    ];

    let bancoFAQ = [];
    let meusChars = [];
    let statusAtivos = {};

    // --- RECOLOCADO: FUN√á√ÉO ESC PARA LIMPAR PESQUISA ---
    window.addEventListener('keydown', (e) => { 
        if (e.key === "Escape") {
            clearSearch();
        } 
    });

    function entrar() {
        const input = document.getElementById('userInput').value.trim();
        const pass = document.getElementById('passInput').value;
        const find = listaStaff.find(s => s.nick.toLowerCase() === input.toLowerCase());
        if(find && pass === "123321") {
            meusChars = listaStaff.filter(s => s.dono === find.dono);
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('loading-screen').classList.remove('hidden');
            carregarTudo(find.admin);
        } else { alert("Dados incorretos!"); }
    }

    async function carregarTudo(isAdmin) {
        try {
            const res = await fetch(`${API_URL}?pass=123321`);
            const data = await res.json();
            bancoFAQ = data.faq || [];
            if(data.aviso) {
                document.getElementById('avisoTitulo').innerText = data.aviso.titulo;
                document.getElementById('avisoTexto').innerText = data.aviso.texto;
            }
        } catch (e) { console.error(e); }

        db.ref('status').on('value', (snap) => {
            const onData = snap.val() || {};
            ["Titan", "Merc√∫rio", "Netuno"].forEach(s => {
                const id = s === "Merc√∫rio" ? "Mercurio" : s;
                const container = document.getElementById('list-' + id);
                if(container) {
                    container.innerHTML = "";
                    listaStaff.filter(t => t.server === s).forEach(t => {
                        const active = onData[t.nick.toLowerCase().replace(/\s/g, '_')] ? "active" : "";
                        container.innerHTML += `<div class="tutor-row"><div class="dot ${active}"></div>${t.nick}</div>`;
                    });
                }
            });
        });

        const area = document.getElementById('multiStatusArea');
        area.innerHTML = "";
        meusChars.forEach(c => {
            area.innerHTML += `<div class="char-card"><span>${c.nick}</span><button id="btn-${c.nick.replace(/\s/g, '')}" class="btn-status-mini status-off" onclick="toggleStatus('${c.nick}')">OFFLINE</button></div>`;
        });

        setTimeout(() => {
            document.getElementById('loading-screen').classList.add('hidden');
            document.getElementById('faq-content').classList.remove('hidden');
            if(isAdmin) document.getElementById('adminQuickBtn').classList.remove('hidden');
            render(bancoFAQ);
        }, 1200);
    }

    function toggleStatus(nick) {
        const btn = document.getElementById('btn-' + nick.replace(/\s/g, ''));
        const nickKey = nick.toLowerCase().replace(/\s/g, '_');
        if(!statusAtivos[nick]) {
            statusAtivos[nick] = Date.now();
            btn.innerText = "ONLINE"; btn.className = "btn-status-mini status-on";
            db.ref('status/' + nickKey).set({ online: true });
            db.ref('status/' + nickKey).onDisconnect().remove();
        } else {
            const min = Math.round((Date.now() - statusAtivos[nick]) / 60000);
            db.ref('logs/' + nickKey).push({ tutor: nick, minutos: min, dataISO: new Date().toISOString().split('T')[0] });
            db.ref('status/' + nickKey).remove();
            btn.innerText = "OFFLINE"; btn.className = "btn-status-mini status-off";
            delete statusAtivos[nick];
        }
    }

    function render(lista) {
        const out = document.getElementById('results');
        if(!out) return;
        out.innerHTML = lista.map(i => `
            <div class="faq-item">
                <div style="flex:1;">
                    <div style="font-weight:bold; color:var(--primary);">${i.pergunta}</div>
                    <div style="color:#bbb; font-size:12px;">${i.resposta}</div>
                </div>
                <button class="btn-status-mini status-on" style="min-width:85px;" onclick="copiar(this, '${i.resposta.replace(/'/g, "\\'")}')">COPIAR</button>
            </div>
        `).join('');
    }

    function copiar(btn, texto) {
        navigator.clipboard.writeText(texto);
        const originalText = "COPIAR";
        btn.innerText = "COPIADO";
        btn.classList.add('copy-active');
        setTimeout(() => {
            btn.innerText = originalText;
            btn.classList.remove('copy-active');
        }, 1000);
    }

    function handleSearch() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const btnClear = document.getElementById('btnClear');
        if(btnClear) btnClear.style.display = q ? 'block' : 'none';
        render(bancoFAQ.filter(i => i.pergunta.toLowerCase().includes(q)));
    }

    function clearSearch() { 
        const input = document.getElementById('searchInput');
        const btnClear = document.getElementById('btnClear');
        if(input) input.value = ''; 
        if(btnClear) btnClear.style.display = 'none'; 
        render(bancoFAQ); 
    }

    async function abrirAdmin() {
        const snap = await db.ref('logs').once('value');
        const logs = snap.val() || {};
        let html = "<table style='width:100%; border-collapse:collapse; color:#ccc;'><tr><th style='text-align:left; color:var(--primary);'>TUTOR</th><th>TOTAL (Horas)</th></tr>";
        const stats = {};
        for(let n in logs) for(let id in logs[n]) {
            const i = logs[n][id];
            if(!stats[i.tutor]) stats[i.tutor] = 0;
            stats[i.tutor] += i.minutos;
        }
        for(let n in stats) html += `<tr style='border-bottom:1px solid #222;'><td style='padding:8px;'>${n}</td><td>${(stats[n]/60).toFixed(1)}h</td></tr>`;
        document.getElementById('adminReport').innerHTML = html + "</table>";
    }

    function confirmarLimpeza() { if(confirm("Apagar tudo?")) { db.ref('logs').remove(); abrirAdmin(); } }
    function toggleModal(id, show) { document.getElementById(id).classList.toggle('active', show); if(id === 'adminModal' && show) abrirAdmin(); }
</script>
</body>
</html>